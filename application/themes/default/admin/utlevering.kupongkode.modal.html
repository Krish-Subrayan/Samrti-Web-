<!-- 10 starts -->

<div id="discount_modal10" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog rabatt">
    <div class="modal-content">
      <div class="modal-header back-color">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
        <h4 class="modal-title text-center">Legg til rabatt</h4>
      </div>
      <div class="modal-body login">
        <div class="form-login-wrapper">
          
          <form action="" id="discount_modal10">
            <div class="percentage-buttons group-pos">
              <div class="clearfix">
                <div class="btn-group">
                  <button type="button" data-switch-set="#discount_type10" data-switch-value="%" class="btn btn-default">%</button>
                  <button type="button" data-switch-set="#discount_type10" data-switch-value="Kr" class="btn btn-default">Kr</button>
                  <button type="button" data-switch-set="#discount_type10" data-switch-value="Kupongkode" class="btn btn-default">Kupongkode</button>
                </div>
                <input type="hidden" name="discount_type10" id="discount_type10">
              </div>
            </div>
            <div class="input-wrapper">
              <div class="row">
                <div class="col-xs-12">
                  <input type="text" name="discount_val10" placeholder="0" id="discount_val10" />
                </div>
              </div>
            </div>
            <div class="percentage-container">
              <div class="percentage-wrapper">
                <div class="row">
                  <div class="col-xs-2 percent">
                    <div data-discount="5">5%</div>
                  </div>
                  <div class="col-xs-2 percent">
                    <div data-discount="10">10%</div>
                  </div>
                  <div class="col-xs-2 percent">
                    <div data-discount="20">20%</div>
                  </div>
                  <div class="col-xs-2 percent">
                    <div data-discount="30">30%</div>
                  </div>
                  <div class="col-xs-2 percent">
                    <div data-discount="50">50%</div>
                  </div>
                  <div class="col-xs-2 pull-right">
                    <div class="clear fs-10 red-clear">Fjern</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="alphabetic-wrapper">
              <div class="row">
                <div data-alpha="1" class="alpha">1</div>
                <div data-alpha="2" class="alpha">2</div>
                <div data-alpha="3" class="alpha">3</div>
                <div data-alpha="4" class="alpha">4</div>
                <div data-alpha="5" class="alpha">5</div>
                <div data-alpha="6" class="alpha">6</div>
                <div data-alpha="7" class="alpha">7</div>
                <div data-alpha="8" class="alpha">8</div>
                <div data-alpha="9" class="alpha">9</div>
                <div data-alpha="0" class="alpha">0</div>
              </div>
              <div class="row">
                <div data-alpha="Q" class="alpha">Q</div>
                <div data-alpha="W" class="alpha">W</div>
                <div data-alpha="E" class="alpha">E</div>
                <div data-alpha="R" class="alpha">R</div>
                <div data-alpha="T" class="alpha">T</div>
                <div data-alpha="Y" class="alpha">Y</div>
                <div data-alpha="U" class="alpha">U</div>
                <div data-alpha="I" class="alpha">I</div>
                <div data-alpha="O" class="alpha">O</div>
                <div data-alpha="P" class="alpha">P</div>
              </div>
              <div class="row">
                <div data-alpha="A" class="alpha">A</div>
                <div data-alpha="S" class="alpha">S</div>
                <div data-alpha="D" class="alpha">D</div>
                <div data-alpha="F" class="alpha">F</div>
                <div data-alpha="G" class="alpha">G</div>
                <div data-alpha="H" class="alpha">H</div>
                <div data-alpha="J" class="alpha">J</div>
                <div data-alpha="K" class="alpha">K</div>
                <div data-alpha="L" class="alpha">L</div>
              </div>
              <div class="row">
                <div data-alpha="Z" class="alpha">Z</div>
                <div data-alpha="X" class="alpha">X</div>
                <div data-alpha="C" class="alpha">C</div>
                <div data-alpha="V" class="alpha">V</div>
                <div data-alpha="B" class="alpha">B</div>
                <div data-alpha="N" class="alpha">N</div>
                <div data-alpha="M" class="alpha">M</div>
              </div>
              <div class="row">
                <div data-alpha=" " class="alpha alpha-space">Space</div>
                <div>
                  <input type="submit" value="OK">
                </div>
              </div>
            </div>
            <div class="numeric-wrapper">
              <div class="clearfix">
                <div class="col-xs-4">
                  <div class="num">7</div>
                </div>
                <div class="col-xs-4">
                  <div class="num">8</div>
                </div>
                <div class="col-xs-4">
                  <div class="num">9</div>
                </div>
              </div>
              <div class="clearfix">
                <div class="col-xs-4">
                  <div class="num">4</div>
                </div>
                <div class="col-xs-4">
                  <div class="num">5</div>
                </div>
                <div class="col-xs-4">
                  <div class="num">6</div>
                </div>
              </div>
              <div class="clearfix">
                <div class="col-xs-4">
                  <div class="num">1</div>
                </div>
                <div class="col-xs-4">
                  <div class="num">2</div>
                </div>
                <div class="col-xs-4">
                  <div class="num">3</div>
                </div>
              </div>
              <div class="clearfix">
                <div class="col-xs-4">
                  <div class="dot">.</div>
                </div>
                <div class="col-xs-4">
                  <div class="num">0</div>
                </div>
                <div class="col-xs-4 blue">
                  <div>
                    <input type="submit" value="OK">
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
	$(document).ready(function() {	  
		$("[data-switch-set]").on("click", function() {
			id = $(this).data("switch-set");
			$(id).val($(this).data("switch-value"));
			$('#discount_val10').focus();
		});
		
		/* group pos starts */
		$('.group-pos .btn-group > .btn').on("click", function() {
			$('.group-pos .btn-group > .btn').removeClass('highlight');
			$(this).addClass('highlight');	
		});
		/* group pos ends */
		
		$('.percentage-buttons .btn').on("click", function() {
			$('.percentage-wrapper .percent').hide();
			$('.numeric-wrapper').show();
			$('#discount_modal10 .alphabetic-wrapper').hide();
			percentage_val = $(this).data('switch-value');
			if(percentage_val == '%') {
				$('.percentage-wrapper .percent').show();
			}else if(percentage_val == 'Kr'){
				
			}else if(percentage_val == 'Kupongkode'){
				$('#discount_modal10 .numeric-wrapper').hide();
				$('#discount_modal10 .alphabetic-wrapper').show();
			}
		});
		$('.percentage-buttons .btn-group .btn:first').trigger('click');
		
		$('.percentage-wrapper .percent').on("click", function() {
			$('.percentage-wrapper .percent').removeClass('highlight');
			$(this).addClass('highlight');	
			$('#discount_val10').val($(this).find('div').data('discount'));
			$('#discount_val10').focus();
		});
		
		$(".clear").click(function(){    
			$('.percentage-wrapper .percent').removeClass('highlight');
			$('#discount_modal10 .alpha').removeClass('highlight');
			$('#discount_val10').val('');
			$('#discount_val10').focus();
		});
		
		$('#discount_modal10 .numeric-wrapper .num').on("click",function(){
			new_val = $('#discount_val10').val();
			$('#discount_val10').val(new_val + $(this).html());
			$('#discount_val10').focus();
		});
		
		$('#discount_modal10 .numeric-wrapper .dot').on("click",function(){
			str = $('#discount_val10').val();
			n = str.indexOf('.');
			if(n == -1){
				prefix = ($('#discount_val10').val() == '') ? '0' : $('#discount_val10').val();
				$('#discount_val10').val(prefix + $(this).html());
				$('#discount_val10').focus();
			}
		});
		
		$('#discount_modal10 .alpha').on('click',function(){
			$('#discount_modal10 .alpha').removeClass('highlight');
			$(this).addClass('highlight');	
			new_val = $('#discount_val10').val();
			alpha_val = $(this).data('alpha');
			$('#discount_val10').val(new_val + alpha_val);
			$('#discount_val10').focus();
		});
		
		$("form#discount_modal10").submit(function(){
			$("#coupon_msg").hide();
			$('input[name="discount_type_10"]').val($('#discount_type10').val());
			$('input[name="discount_value_10"]').val($('#discount_val10').val());
			$('#discount_modal10').modal('hide');
			var discount_type = $('#discount_type10').val();
			var discount_val = $('#discount_val10').val();
			var delsum = $('#delsum').val();
			var oid = $('#eorder_id').val();
			
			
			if(discount_type == 'Kupongkode'){
				//if the discount is kupongcode	
				applyVoucher(discount_val)
			}
			else{
				
				 //if the discount is  % or kr 	
				 $.ajax({
						type: "POST",
						url: "[conf.site_url;noerr]/admin/orders/discount",
						data: {
							discount_type: discount_type,
                            discount_val : discount_val,
							oid: oid,
							delsum: delsum
						},
					   beforeSend: function(){
							 $("#coupon_msg").hide();
					   },
					   complete: function(){
							processing = false;
							$("#coupon_msg").show();
					   },
					   dataType: "json",
					   success: function (data) {
						 if(data.error=='true'){
                         
							$( "#coupon_msg" ).html( '<div class="alert alert-danger"><strong><i class="fa fa-warning"></i>Oh snap!</strong> Endre noe og prøv å sende på nytt.<ul><li>'+ data.error1 +'</li></ul>').show();
                            	
								$( ".kunpongkode").hide();
								$('#discount').val('');
								$( "#voucher_id").val();
						   }
						   else{
							 
							 $( ".discount").html('kr ' + data.discount_price_currency + '');
							 $('#discount').val(data.discount_price);
							 $( "#discount_text").html(" (" + data.name + ')');
							 
							 $( ".discount").show();
							 $('.kunpongkode').show();
							
						   }
						   
							$('.mva').html('kr '+ data.mva +'');
							$('#total').val(data.total); 
							$('.total').html('kr '+data.total_currenccy+'');
						   
				  }
			});
				
		  }
			$('#discount_val10').val('');
			$('.percentage-wrapper .percent').removeClass('highlight');
			$('.alphabetic-wrapper .alpha ').removeClass('highlight');
			return false;
		});
	
	});
	
function roundToTwo(num) {    
    return +(Math.round(num + "e+2")  + "e-2");
}
function applyVoucher(voucher)
{
	var oid = $('#eorder_id').val();
	var delsum = $('#delsum').val();
	if(voucher != '')
	{	
		 $.ajax({
						type: "POST",
						url: "[conf.site_url;noerr]/admin/orders/voucher-discount",
						data: {
							voucher: voucher,
							oid: oid,
							delsum: delsum
							
						},
					   beforeSend: function(){
							// $("#ajax-loader").show();
							 $("#coupon_msg").hide();
					   },
					   complete: function(){
							processing = false;
							//$("#ajax-loader").hide();
							$("#coupon_msg").show();
					   },
					   dataType: "json",
					   success: function (data) {
						 if(data.error=='true'){
							$( "#coupon_msg" ).html( '<div class="alert alert-danger"><strong><i class="fa fa-warning"></i>Oh snap!</strong> Endre noe og prøv å sende på nytt.<ul><li>'+ data.error1 +'</li><li>'+ data.error2 +'</li></ul>').show();	
								$( ".kunpongkode").hide();
								$('#discount').val('');
								$( "#voucher_id").val();
						   }
						   else{
							 $( "#coupon_msg" ).html( '<div class="alert alert-success"><strong><i class="fa fa-thumbs-o-up"></i> </strong>Du har en rabatt på <strong>kr ' + data.discount_price_currency + '</strong></div>' ).show();					
							 
							 
							//$( "#delivery_price").val(delivery_price);
							 $( ".discount").html('kr ' + data.discount_price_currency + '');
							 $('#discount').val(data.discount_price);
							 $( "#discount_text").html(" (" + data.name + ')');
							 
							
							 $( "#voucher_id").val(data.id);														 
							 //$("#discount_val10").attr("readonly", "readonly");
							 $( ".discount").show();
							 $('.kunpongkode').show();

							 token = true;
							
						   }
						   
							$('.mva').html('kr '+ data.mva +'');
							$('#total').val(data.total); 
							$('.total').html('kr '+data.total_currenccy+'');
						   
						}
	  });
			
	}
			
}
$('#discountlink').on('click',function(e){
			$('#discount_val10').focus();
			setTimeout(function() { $('#discount_val10').focus() }, 600);
			$('.saldo-buttons a').removeClass('highlight');
			$('.saldo-button button').removeClass('highlight');
		
			$('#discount_val10').val('');
			$('#discount_val10').focus();
			
			$('#discount_type10').val('');
			
			//$('.saldo-buttons').show();
			$("#discount_val10").attr("placeholder","0")

		
		});
</script> 
<!-- 10 ends -->